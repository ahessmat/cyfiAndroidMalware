import sys
import subprocess
import time

#Arguments include:
# args[0] = APK path
# args[1:] = Methods to hook
args = sys.argv[1:] #Exclude name of script

#for arg in args:
#    print("Argument: ", arg)

image_name = 'budtmo/docker-android:emulator_11.0'
apk_path = args[0]

def run_android_docker(apk_path):
    sys.stdout.flush()
    print("Trying to start docker container")
    subprocess.run(['docker','run','-d','-p','6080:6080','-p','5554:5554','-p','5555:5555','-e','EMULATOR_DEVICE="Samsung Galaxy S10"','-e','WEB_VNC=true','--device','/dev/kvm','--name', 'android-container', image_name])
    time.sleep(5)
    sys.stdout.flush()
    print("Checking if container is running")
    subprocess.run(['docker','ps','-a'])
    #docker_output = subprocess.check_output('docker ps')
    #active_containers = docker_output.decode('utf-8').strip().split('\n')[1:]
    #for container in active_containers:
    #    print("Container " + container + " is active!")
    #print(active_containers)

    print("Cleaning up docker container")
    sys.stdout.flush()
    subprocess.run(['docker','container','rm','-f','android-container'])
    #print("Did we terminate? " + result.stdout)
    sys.stdout.flush()
    subprocess.run(['docker','ps','-a'])
    #print("If there's a contained ID here, then termination failed: " + result.stdout)

run_android_docker(apk_path)

    